from datetime import datetime, timezone

from acspype.packet import parse_packet, ParsedPacket
from acspype.structures import ACSPacket
from acspype.qaqc import FLAG, syntax_test

TEST_TIME = datetime.now(timezone.utc)

# TEST_PACKET is from OOI CE02SHSM 20240412_023018.optaa.log.
TEST_PACKET = b'\xff\x00\xff\x00\x02\xe0\x05\x01S\x00\x00\xb8\x01\xdb\x00\x00\x02\xbc~^\xc3\xe3\x01\xdd\x02\xc6\x00\x000\x80\x01X\x1c4\x11R\x16\x90\x13\x7f-\x14\x1b\x89$\xaa\x1f\xa6D\xe6)W8\xd60La\xc76\xf5S\x0f@\xc8y\xb4?\x89j\xb1KQ\x83\xb0?\xdav\xacK\xdf|\xbf9\x88r\xb1Drl\x8b1\xffdc;\x8b]`,\x97V[5+S\xeb*\xc3M\x943\x1cQ\xdb-~K\x926\x87W\xb14aQ\x18>\xe4cM<\xe9\\\xfcI(p\xa0F\x16j\xfbT@}`M\xecx\xd3]\xaf\x86\xa3R\xbe\x83\xb7c\x83\x8a\xd1T\x83\x89\x85e\xc2\x8b\x03T\xbb\x8a\xe7f>\x88\xd6S\x9d\x8a\te"\x85\x05Q\x99\x87kb\xf4\x80QO4\x83\xbf`Y{@L\xc9\x7f~]\xbfv\x8cJ\xc0{M[\xa7r\x99I_w\xfeZbokH-uuYBl\x8dG&sOXYj.G\x12qCX\xabi2G\xcap\xacY\xf5iYI\x13qN[\xf6j\xafKMs\x0f_,l\xf9N-v\nc6o\x9aP\xe6yWg\x14r&S6|\xcajwt\x99U\x91\x7f\xe7m\xeev\xb7We\x82\xf3p\xb1w\xb3X\x17\x84\xc6q\xfawQW\x8e\x84\xfeq\xa8u\xb7V9\x83\xbapZs\xc6T\xcf\x81\xf6n\xe6q#R\xdc\x7f\x9bl\xb5n\x0bQ\x14|gj\xc5k\x1dO\\y\x86h\xddhmM\xa1v\xd9f\xe8f\x02Lqt<e\xaad\\K\x85r\x89d\xaea\x8fH\xdfm\xceaz`\xfeH\xd8m3a\x93`\xfcI\x04mVa\xcfa\nIXm\x88b,a J\x13m\xa2c\x00a\xd4J\xfbnAd\x03b\xbbL\x14n\xd3eAc\xf0Mpo\xa5f\xf7eUOup\xc9i\xb7g2P\xb5r|kviAP\xceu\x19k\xcai\x9cQ?u\xecl\x9eirQ\xa5u\x93m^i\x95Q\xeau\xecm\xeei\xbdQ\x8bvSm\x90i\x12P\xb6u\xf4l\x9fg\xc6O\xaet\x95kOfMN\ts\x04i\x19d\x87K\xf4q\x1ffCa\xefI\x94nAb\xf9^\xb6G\x14j\x94_\x85[-D0f\x85[\x9cW\x87AObmW\xc2S\xd3>?^\x0cS\x9aP\r:\xb8Y\xecN\xd0K\xa37uT\xe2JNGK4JO\xafE\xcfC/0\xebJ\xee@\xf1>\xed-\xc8E\xe5<A:\xcf*\xda@\xb37\xba7&\'\xe8< 3\x1d3^%\x197L.\x95/\xa0"X2Z*#,\x0f\x1f\xcd-\xa5%\xe8(\xaa\x1dx)\x07!\xf4%\xa8\x1b6$\xdd\x1e("\xd8\x19& \xeb\x1a\xa9 ;\x17.\x1dP\x17u\x1d\xc2\x15h\x19\xde\x14\xa0\x1b{\x13\xce\x16\xc9\x12M\x19_\x12L\x14\x03\x10Q\x17i\x10\xf0\x11\xc5\x0e\xad\x15\x98\x0e\xf2\x0f\xd0\x0c\xa58\x18\x00'


def test():
    assert isinstance(TEST_PACKET, bytes)

    acs_packet = ACSPacket(daq_time=TEST_TIME, full_packet=TEST_PACKET)
    assert isinstance(acs_packet, ACSPacket)

    assert syntax_test(acs_packet.full_packet) != FLAG.NOT_EVALUATED

    parsed_packet = parse_packet(acs_packet)
    assert isinstance(parsed_packet, ParsedPacket)
